package main

import (
	"fmt"
	"image/color"
	"os"

	"gocv.io/x/gocv"
)

func main() {
	xmpPath := "haarcascade_frontalface_default.xml"
	var camera *gocv.VideoCapture
	var err error
	if len(os.Args) > 1 {
		camera, err = gocv.OpenVideoCapture(os.Args[1])
	} else {
		deviceid = 0
		camera, err = gocv.OpenVideoCapture(deviceID)
	}
	if err != nil {
		fmt.Println(err)
		return
	}
	if !camera.IsOpened() {
		fmt.Println("not open")
		return
	}
	defer camera.Close()

	gray := gocv.NewMat()
	gocv.CvtColor(src, &gray, gocv.ColorRGBToGray)
	equalize := gocv.NewMat()
	gocv.EqualizeHist(gray, &equalize)

	objDetector := gocv.NewCascadeClassifier()
	defer objDetector.Close()
	objDetector.Load(xmpPath)

	objs := objDetector.DetectMultiScale(equalize)

	dst := gocv.NewMat()
	src.CopyTo(&dst)
	for _, v := range objs {
		gocv.Rectangle(&dst, v, color.RGBA{255, 255, 0, 0}, 2)
	}

	srcWindow := gocv.NewWindow("src")
	srcWindow.SetWindowProperty(gocv.WindowPropertyAutosize, gocv.WindowAutosize)

	dstWindow := gocv.NewWindow("dst")

	srcWindow.IMShow(src)
	dstWindow.IMShow(dst)
	gocv.WaitKey(0)

}
